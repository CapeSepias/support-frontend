@import admin.settings.AllSettings
@import assets.{AssetsResolver, RefPath, StyleContent}
@import com.gu.identity.model.{User => IdUser}
@import com.gu.support.encoding.CustomCodecs._
@import com.gu.support.redemptions.redemptions.RawRedemptionCode
@import helper.CSRF
@import views.ReactDiv
@import io.circe.syntax._

@import io.circe.Json
@(
  title: String,
  mainElement: ReactDiv,
  js: String,
  css: String,
  fontLoaderBundle: Either[RefPath, StyleContent],
  csrf: Option[String],
  uatMode: Boolean,
  stage: String,
  redemptionCode: RawRedemptionCode,
  maybeRedemptionError: Option[String],
  user: Option[IdUser],
  submitted: Boolean
)(implicit assets: AssetsResolver, requestHeader: RequestHeader, settings: AllSettings)

  @main(title = title, mainJsBundle = Left(RefPath(js)), mainElement = mainElement, mainStyleBundle = Left(RefPath(css)), fontLoaderBundle = fontLoaderBundle, csrf = csrf) {
    <script type="text/javascript">
      window.guardian = window.guardian || {};
      window.guardian.stage = "@stage";
      window.guardian.userCode = "@Html(redemptionCode.replaceAll(""""""", """\\""""))";
      window.guardian.error = "@Html(maybeRedemptionError.getOrElse("").replaceAll(""""""", """\\""""))";
      window.guardian.submitted = @submitted;
      window.guardian.user = {
        firstName: "@user.map(_.privateFields.firstName).getOrElse("")",
        lastName: "@user.map(_.privateFields.secondName).getOrElse("")",
        email: "@user.map(_.primaryEmailAddress).getOrElse("")",
      };
  </script>

  }

